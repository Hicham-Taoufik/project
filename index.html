<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Information</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: auto; }
        h1 { text-align: center; }
        .info { margin-bottom: 10px; font-size: 18px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Patient Information</h1>
        <p class="info"><strong>Name:</strong> <span id="name"></span></p>
        <p class="info"><strong>CIN:</strong> <span id="cin"></span></p>
        <p class="info"><strong>Date of Birth:</strong> <span id="dob"></span></p>
        <p class="info"><strong>Address:</strong> <span id="address"></span></p>

        <h2>Doctor Notes</h2>
        <textarea id="notes" rows="4" cols="50" placeholder="Enter your notes..."></textarea><br>
        <button onclick="submitNotes()">Submit Notes</button>
    </div>

    <script>
        // Function to get URL parameters
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Get CIN from the URL
        const cin = getQueryParam("cin");
        if (!cin) {
            alert("No CIN provided in URL");
        } else {
            // Fetch patient data from n8n
            fetch(`https://workflows.aphelionxinnovations.com/webhook-test/patient-info?cin=${cin}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById("name").textContent = data.name;
                    document.getElementById("cin").textContent = data.cin;
                    document.getElementById("dob").textContent = data.dob;
                    document.getElementById("address").textContent = data.address;
                })
                .catch(error => console.error("Error fetching data:", error));
        }

        // Function to send doctor notes
        function submitNotes() {
            const notes = document.getElementById("notes").value;
            fetch("https://your-n8n-instance.com/webhook-test/save-notes", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ cin: cin, notes: notes })
            })
            .then(response => response.json())
            .then(data => alert("Notes saved successfully!"))
            .catch(error => console.error("Error saving notes:", error));
        }
    </script>
</body>
</html>
